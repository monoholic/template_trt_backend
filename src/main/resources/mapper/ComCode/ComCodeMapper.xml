<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.trito.domain.repository.mybatis.comCode.ComCodeRepository">
    <!-- total rows -->
    <select id="selectCountGrpCode" parameterType="kr.co.trito.dto.Mybatis.comCode.ComCodeGrpListParamsDto" resultType="int">
        SELECT COUNT(*)
        FROM TP_COMM_CODE_GRP
        WHERE 1=1
        <if test="searchOpt != null">
            AND ${searchOpt} LIKE CONCAT(CONCAT('%', #{searchTxt}), '%')
        </if>
        <if test="searchUseYn != null">
            AND USE_YN = #{searchUseYn}
        </if>
    </select>

    <!-- 공통코드 그룹 목록 조회 -->
    <select id="getComCodeGrpList" parameterType="kr.co.trito.dto.Mybatis.comCode.ComCodeGrpParmsDto" resultType="kr.co.trito.dto.Mybatis.comCode.ComCodeGrpListDto">
        SELECT *
          FROM(
            SELECT
                  ROWNUM AS rn
                , CODE_GRP_ID
                , CODE_GRP_NM
                , CODE_GRP_ENG_NM
                , CODE_GRP_DESC
                , SORT_ORD
                , USE_YN
                , UPD_ID
                , UPD_DATE
                , REG_ID
                , REG_DATE
            FROM(
                SELECT
                      CODE_GRP_ID
                    , CODE_GRP_NM
                    , CODE_GRP_ENG_NM
                    , CODE_GRP_DESC
                    , SORT_ORD
                    , USE_YN
                    , UPD_ID
                    , UPD_DATE
                    , REG_ID
                    , REG_DATE
                FROM TP_COMM_CODE_GRP
                WHERE 1=1
                    <if test="comCodeGrpListParamsDto.searchOpt != null">
                        AND ${searchOpt} LIKE CONCAT(CONCAT('%', #{comCodeGrpListParamsDto.searchTxt}), '%')
                    </if>
                    <if test="comCodeGrpListParamsDto.searchUseYn != null">
                        AND USE_YN = #{comCodeGrpListParamsDto.searchUseYn}
                    </if>
                <if test="comCodeGrpListParamsDto.sortBy != null and comCodeGrpListParamsDto.descending == 'ac'">
                    ORDER BY ${userListParamsDto.sortBy} ASC
                </if>
                <if test="comCodeGrpListParamsDto.sortBy != null and comCodeGrpListParamsDto.descending == 'dc'">
                    ORDER BY ${userListParamsDto.sortBy} DESC
                </if>
            )
          )
        WHERE rn BETWEEN #{condition.start} AND #{condition.end}
    </select>
</mapper>